<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <style type="text/css">
        html, body {
            min-height: 100%;
        }
    </style>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.1/css/bootstrap.min.css" rel="stylesheet" />    
    <title>Image Vulnerability Scorecard</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.css">
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.js"></script>


    <script>
      function load() {
        let tableData = undefined;
        let tablearray = [];  
        d3.json("scans/out/images_trivy.json").then(function(data){ 
          tableData = data.images;

          let table = d3.select("#images-table")
          tableData.forEach(d => {
            let item = [];
            let critical = d.issues.find(element => element.severity.toLowerCase() == "critical");
            let high = d.issues.find(element => element.severity.toLowerCase() == "high");
            let medium = d.issues.find(element => element.severity.toLowerCase() == "medium");
            let low = d.issues.find(element => element.severity.toLowerCase() == "low");
            critical = critical ? critical.count : 0
            high = high ? high.count : 0
            medium = medium ? medium.count : 0
            low = low ? low.count : 0
            let error= d.error != "" ? '<i class="fas fa-exclamation-triangle"></i>' : "";     

            item.push("-");
            item.push(d.image); 
            item.push(critical);
            item.push(high);
            item.push(medium); 
            item.push(low);
            item.push(error);
            
            tablearray.push(item);

          });

          $(document).ready( function () {
              $('#images-table').DataTable( {
                searching: false,
                 paging: false,
                 data: tablearray
                  });          
          });          
        });

        }
    </script>

  </head>
  <body onload="load();">
    <script src="https://d3js.org/d3.v6.min.js"></script>
    
    <h1 class="card-header text-uppercase text-dark-50 bg-light">Image Vulnerability Scorecard</h1>
    
      <div class="table-responsive">
          <table id="images-table" class="table compact">
            <thead>
              <tr>
                <th scope="col">Namespace</th>
                <th scope="col">Image</th>
                <th scope="col">Critical</th>
                <th scope="col">High</th>
                <th scope="col">Medium</th>
                <th scope="col">Low</th>
                <th scope="col">Error</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>
      
    </div>
    


</body>
</html>